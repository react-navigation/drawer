{"version":3,"sources":["DrawerView.tsx"],"names":["React","Dimensions","StyleSheet","SceneView","ScreenContainer","DrawerActions","DrawerSidebar","DrawerGestureContext","ResourceSavingScene","Drawer","DrawerView","state","loaded","props","navigation","index","drawerWidth","navigationConfig","drawerGestureRef","createRef","handleDrawerOpen","dispatch","openDrawer","key","handleDrawerClose","closeDrawer","updateWidth","setState","renderNavigationView","progress","screenProps","descriptors","contentComponent","contentOptions","drawerPosition","style","renderContent","lazy","routes","unmountInactiveRoutes","activeKey","descriptor","getComponent","styles","content","map","route","includes","isFocused","absoluteFill","opacity","setDrawerGestureRef","ref","current","addEventListener","removeEventListener","drawerType","drawerBackgroundColor","overlayColor","contentContainerStyle","edgeWidth","minSwipeDistance","hideStatusBar","statusBarAnimation","drawerLockMode","options","isOpen","isDrawerOpen","backgroundColor","width","nextProps","prevState","PureComponent","defaultProps","create","flex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Dimensions, StyleSheet, ViewStyle } from 'react-native';\nimport { SceneView } from '@react-navigation/core';\nimport { ScreenContainer } from 'react-native-screens';\n\nimport * as DrawerActions from '../routers/DrawerActions';\nimport DrawerSidebar, { ContentComponentProps } from './DrawerSidebar';\nimport DrawerGestureContext from '../utils/DrawerGestureContext';\nimport ResourceSavingScene from './ResourceSavingScene';\nimport Drawer from './Drawer';\nimport { Navigation } from '../types';\nimport { PanGestureHandler } from 'react-native-gesture-handler';\n\ntype DrawerOptions = {\n  drawerBackgroundColor?: string;\n  overlayColor?: string;\n  minSwipeDistance?: number;\n  drawerPosition: 'left' | 'right';\n  drawerType: 'front' | 'back' | 'slide';\n  drawerLockMode?: 'unlocked' | 'locked-closed' | 'locked-open';\n  keyboardDismissMode?: 'on-drag' | 'none';\n  drawerWidth: number | (() => number);\n  statusBarAnimation: 'slide' | 'none' | 'fade';\n  onDrawerClose?: () => void;\n  onDrawerOpen?: () => void;\n  contentContainerStyle?: ViewStyle;\n  edgeWidth: number;\n  hideStatusBar?: boolean;\n  style?: ViewStyle;\n};\n\ntype Props = {\n  lazy: boolean;\n  navigation: Navigation;\n  descriptors: {\n    [key: string]: {\n      navigation: {};\n      getComponent: () => React.ComponentType<{}>;\n      options: DrawerOptions;\n    };\n  };\n  navigationConfig: DrawerOptions & {\n    contentComponent?: React.ComponentType<ContentComponentProps>;\n    unmountInactiveRoutes?: boolean;\n    contentOptions?: object;\n  };\n  screenProps: unknown;\n};\n\ntype State = {\n  loaded: number[];\n  drawerWidth: number;\n};\n\n/**\n * Component that renders the drawer.\n */\nexport default class DrawerView extends React.PureComponent<Props, State> {\n  static defaultProps = {\n    lazy: true,\n  };\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    const { index } = nextProps.navigation.state;\n\n    return {\n      // Set the current tab to be loaded if it was not loaded before\n      loaded: prevState.loaded.includes(index)\n        ? prevState.loaded\n        : [...prevState.loaded, index],\n    };\n  }\n\n  state: State = {\n    loaded: [this.props.navigation.state.index],\n    drawerWidth:\n      typeof this.props.navigationConfig.drawerWidth === 'function'\n        ? this.props.navigationConfig.drawerWidth()\n        : this.props.navigationConfig.drawerWidth,\n  };\n\n  componentDidMount() {\n    Dimensions.addEventListener('change', this.updateWidth);\n  }\n\n  componentWillUnmount() {\n    Dimensions.removeEventListener('change', this.updateWidth);\n  }\n\n  private drawerGestureRef = React.createRef<PanGestureHandler>();\n\n  private handleDrawerOpen = () => {\n    const { navigation } = this.props;\n\n    navigation.dispatch(\n      DrawerActions.openDrawer({\n        key: navigation.state.key,\n      })\n    );\n  };\n\n  private handleDrawerClose = () => {\n    const { navigation } = this.props;\n\n    navigation.dispatch(\n      DrawerActions.closeDrawer({\n        key: navigation.state.key,\n      })\n    );\n  };\n\n  private updateWidth = () => {\n    const drawerWidth =\n      typeof this.props.navigationConfig.drawerWidth === 'function'\n        ? this.props.navigationConfig.drawerWidth()\n        : this.props.navigationConfig.drawerWidth;\n\n    if (this.state.drawerWidth !== drawerWidth) {\n      this.setState({ drawerWidth });\n    }\n  };\n\n  private renderNavigationView = ({ progress }: any) => {\n    return (\n      <DrawerSidebar\n        screenProps={this.props.screenProps}\n        drawerOpenProgress={progress}\n        navigation={this.props.navigation}\n        descriptors={this.props.descriptors}\n        contentComponent={this.props.navigationConfig.contentComponent}\n        contentOptions={this.props.navigationConfig.contentOptions}\n        drawerPosition={this.props.navigationConfig.drawerPosition}\n        style={this.props.navigationConfig.style}\n        {...this.props.navigationConfig}\n      />\n    );\n  };\n\n  private renderContent = () => {\n    let { lazy, navigation } = this.props;\n    let { loaded } = this.state;\n    let { routes } = navigation.state;\n\n    if (this.props.navigationConfig.unmountInactiveRoutes) {\n      let activeKey = navigation.state.routes[navigation.state.index].key;\n      let descriptor = this.props.descriptors[activeKey];\n\n      return (\n        <SceneView\n          navigation={descriptor.navigation}\n          screenProps={this.props.screenProps}\n          component={descriptor.getComponent()}\n        />\n      );\n    } else {\n      return (\n        <ScreenContainer style={styles.content}>\n          {routes.map((route, index) => {\n            if (lazy && !loaded.includes(index)) {\n              // Don't render a screen if we've never navigated to it\n              return null;\n            }\n\n            let isFocused = navigation.state.index === index;\n            let descriptor = this.props.descriptors[route.key];\n\n            return (\n              <ResourceSavingScene\n                key={route.key}\n                style={[\n                  StyleSheet.absoluteFill,\n                  { opacity: isFocused ? 1 : 0 },\n                ]}\n                isVisible={isFocused}\n              >\n                <SceneView\n                  navigation={descriptor.navigation}\n                  screenProps={this.props.screenProps}\n                  component={descriptor.getComponent()}\n                />\n              </ResourceSavingScene>\n            );\n          })}\n        </ScreenContainer>\n      );\n    }\n  };\n\n  private setDrawerGestureRef = (ref: PanGestureHandler | null) => {\n    // @ts-ignore\n    this.drawerGestureRef.current = ref;\n  };\n\n  render() {\n    const { navigation } = this.props;\n    const {\n      drawerType,\n      drawerBackgroundColor,\n      overlayColor,\n      contentContainerStyle,\n      edgeWidth,\n      minSwipeDistance,\n      hideStatusBar,\n      statusBarAnimation,\n    } = this.props.navigationConfig;\n    const activeKey = navigation.state.routes[navigation.state.index].key;\n    const { drawerLockMode } = this.props.descriptors[activeKey].options;\n\n    const isOpen =\n      drawerLockMode === 'locked-closed'\n        ? false\n        : drawerLockMode === 'locked-open'\n        ? true\n        : this.props.navigation.state.isDrawerOpen;\n\n    return (\n      <DrawerGestureContext.Provider value={this.drawerGestureRef}>\n        <Drawer\n          open={isOpen}\n          locked={\n            drawerLockMode === 'locked-open' ||\n            drawerLockMode === 'locked-closed'\n          }\n          onOpen={this.handleDrawerOpen}\n          onClose={this.handleDrawerClose}\n          onGestureRef={this.setDrawerGestureRef}\n          drawerType={drawerType}\n          drawerPosition={this.props.navigationConfig.drawerPosition}\n          contentContainerStyle={contentContainerStyle}\n          drawerStyle={{\n            backgroundColor: drawerBackgroundColor || 'white',\n            width: this.state.drawerWidth,\n          }}\n          overlayStyle={{\n            backgroundColor: overlayColor || 'rgba(0, 0, 0, 0.5)',\n          }}\n          swipeEdgeWidth={edgeWidth}\n          swipeDistanceThreshold={minSwipeDistance}\n          hideStatusBar={hideStatusBar}\n          statusBarAnimation={statusBarAnimation}\n          renderDrawerContent={this.renderNavigationView}\n          renderSceneContent={this.renderContent}\n        />\n      </DrawerGestureContext.Provider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  content: {\n    flex: 1,\n  },\n});\n"]}